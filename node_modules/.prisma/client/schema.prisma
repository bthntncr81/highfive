// HighFive Suite - Database Schema
// PostgreSQL with Prisma ORM

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== LOCATION / BRANCH MANAGEMENT ====================

model Location {
  id           String   @id @default(cuid())
  name         String   // "High Five Kadıköy"
  code         String   @unique // "kadiköy", "besiktas"
  address      String?
  phone        String?
  email        String?
  timezone     String   @default("Europe/Istanbul")
  currency     String   @default("TRY")
  taxRate      Decimal  @default(10) @db.Decimal(5, 2)
  serviceCharge Decimal @default(0) @db.Decimal(5, 2) // Servis ücreti %
  serviceChargeType String @default("PERCENTAGE") // PERCENTAGE, FIXED
  active       Boolean  @default(true)
  isDefault    Boolean  @default(false)
  settings     Json?    // Location specific settings
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  tables    Table[]
  orders    Order[]
  users     User[]
  menuItems MenuItemLocation[]
  happyHours HappyHour[]
}

// ==================== USER MANAGEMENT ====================

enum UserRole {
  ADMIN
  MANAGER
  WAITER
  KITCHEN
  CASHIER
  COURIER
}

model User {
  id         String    @id @default(cuid())
  email      String    @unique
  password   String
  name       String
  role       UserRole  @default(WAITER)
  pin        String?   // Quick PIN login for POS
  avatar     String?
  phone      String?   // Kurye telefonu
  active     Boolean   @default(true)
  locationId String?   // Assigned location
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  location       Location?     @relation(fields: [locationId], references: [id])
  waiterOrders   Order[]       @relation("WaiterOrders")
  courierOrders  Order[]       @relation("CourierOrders")
  sessions       Session[]
  activityLogs   ActivityLog[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  details   Json?
  ipAddress String?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ==================== TABLE MANAGEMENT ====================

enum TableStatus {
  FREE
  OCCUPIED
  RESERVED
  CLEANING
}

model Table {
  id               String      @id @default(cuid())
  locationId       String?
  number           Int         
  name             String?     // "Bahçe 1", "VIP 2" etc.
  capacity         Int         @default(4)
  status           TableStatus @default(FREE)
  positionX        Float?      // For floor plan
  positionY        Float?
  floor            Int         @default(1)
  section          String?     // "İç Mekan", "Bahçe", "Teras"
  active           Boolean     @default(true)
  mergedWithId     String?     // Birleştirildiği ana masa
  sessionToken     String?     // QR sipariş için oturum kodu
  sessionStartedAt DateTime?   // Oturum başlangıç zamanı
  tabEnabled       Boolean     @default(true) // Hesap açık tutulabilir mi
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  location     Location? @relation(fields: [locationId], references: [id])
  orders       Order[]
  mergedWith   Table?    @relation("TableMerge", fields: [mergedWithId], references: [id])
  mergedTables Table[]   @relation("TableMerge")

  @@unique([locationId, number])
}

// ==================== MENU MANAGEMENT ====================

model Category {
  id        String   @id @default(cuid())
  name      String
  icon      String?
  image     String?
  sortOrder Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items MenuItem[]
}

// Alerjen Enum
enum Allergen {
  GLUTEN
  DAIRY
  EGGS
  FISH
  SHELLFISH
  NUTS
  PEANUTS
  SOY
  SESAME
  CELERY
  MUSTARD
  SULPHITES
  LUPIN
  MOLLUSCS
}

model MenuItem {
  id             String     @id @default(cuid())
  categoryId     String
  name           String
  description    String?
  price          Decimal    @db.Decimal(10, 2)
  image          String?
  badges         String[]   // ["Popüler", "Yeni", "Acılı"]
  allergens      Allergen[] // Alerjen bilgileri
  calories       Int?       // Kalori değeri
  prepTime       Int?       // Preparation time in minutes
  
  // Stock Management
  available      Boolean    @default(true)
  outOfStockReason String?  // "Malzeme bitti", "Bugünlük tükendi"
  outOfStockUntil DateTime? // Otomatik açılma zamanı
  stockQuantity  Int?       // Stok miktarı (opsiyonel)
  lowStockAlert  Int?       // Düşük stok uyarı seviyesi
  
  // Sorting & Display
  sortOrder      Int        @default(0)
  featured       Boolean    @default(false) // Öne çıkan ürün
  
  // Pricing
  discountPrice  Decimal?   @db.Decimal(10, 2) // İndirimli fiyat
  discountUntil  DateTime?  // İndirim bitiş tarihi
  
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  category       Category           @relation(fields: [categoryId], references: [id])
  modifiers      Modifier[]
  orderItems     OrderItem[]
  upsellItems    MenuItemUpsell[]   @relation("UpsellFrom")
  upsoldBy       MenuItemUpsell[]   @relation("UpsellTo")
  crossSellItems MenuItemCrossSell[] @relation("CrossSellFrom")
  crossSoldBy    MenuItemCrossSell[] @relation("CrossSellTo")
  locations      MenuItemLocation[]
  happyHourItems HappyHourItem[]
  bundleItems    BundleItem[]
}

// Location-specific menu item settings
model MenuItemLocation {
  id           String   @id @default(cuid())
  menuItemId   String
  locationId   String
  available    Boolean  @default(true)
  price        Decimal? @db.Decimal(10, 2) // Location specific price override
  createdAt    DateTime @default(now())

  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  location Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([menuItemId, locationId])
}

// Upselling - "Bununla birlikte X de ister misiniz?"
model MenuItemUpsell {
  id            String   @id @default(cuid())
  fromItemId    String
  toItemId      String
  message       String?  // "Yanında patates ister misiniz?"
  discountAmount Decimal? @db.Decimal(10, 2) // Upsell indirimi
  sortOrder     Int      @default(0)
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())

  fromItem MenuItem @relation("UpsellFrom", fields: [fromItemId], references: [id], onDelete: Cascade)
  toItem   MenuItem @relation("UpsellTo", fields: [toItemId], references: [id], onDelete: Cascade)

  @@unique([fromItemId, toItemId])
}

// Cross-selling - Sepette X varken Y öner
model MenuItemCrossSell {
  id            String   @id @default(cuid())
  fromItemId    String
  toItemId      String
  message       String?  // "Bunu da beğenebilirsiniz"
  discountAmount Decimal? @db.Decimal(10, 2)
  sortOrder     Int      @default(0)
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())

  fromItem MenuItem @relation("CrossSellFrom", fields: [fromItemId], references: [id], onDelete: Cascade)
  toItem   MenuItem @relation("CrossSellTo", fields: [toItemId], references: [id], onDelete: Cascade)

  @@unique([fromItemId, toItemId])
}

model Modifier {
  id         String   @id @default(cuid())
  menuItemId String
  name       String   // "Ekstra Peynir", "Acısız" etc.
  price      Decimal  @default(0) @db.Decimal(10, 2)
  available  Boolean  @default(true)
  createdAt  DateTime @default(now())

  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
}

// Happy Hours - Zamanlı indirimler/menü değişiklikleri
model HappyHour {
  id          String   @id @default(cuid())
  locationId  String?
  name        String   // "Happy Hour", "Öğle Menüsü"
  description String?
  startTime   String   // "17:00"
  endTime     String   // "19:00"
  daysOfWeek  Int[]    // [1,2,3,4,5] = Pazartesi-Cuma
  
  // İndirim Seçenekleri
  discountType    String?  // "PERCENT", "FIXED", "CAMPAIGN"
  discountPercent Decimal? @db.Decimal(5, 2) // Yüzde indirim
  discountAmount  Decimal? @db.Decimal(10, 2) // Sabit tutar indirim
  campaignId      String?  // Bağlı kampanya ID
  
  active      Boolean  @default(true)
  startDate   DateTime? // Kampanya başlangıç
  endDate     DateTime? // Kampanya bitiş
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  location Location?       @relation(fields: [locationId], references: [id])
  campaign Campaign?       @relation(fields: [campaignId], references: [id])
  items    HappyHourItem[]
}

model HappyHourItem {
  id          String   @id @default(cuid())
  happyHourId String
  menuItemId  String
  specialPrice Decimal? @db.Decimal(10, 2) // Özel fiyat
  discountPercent Decimal? @db.Decimal(5, 2) // veya % indirim
  createdAt   DateTime @default(now())

  happyHour HappyHour @relation(fields: [happyHourId], references: [id], onDelete: Cascade)
  menuItem  MenuItem  @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@unique([happyHourId, menuItemId])
}

// ==================== ORDER MANAGEMENT ====================

enum OrderStatus {
  PENDING           // Just created
  CONFIRMED         // Confirmed by kitchen
  PREPARING         // Being prepared
  READY             // Ready for service
  OUT_FOR_DELIVERY  // Kurye yolda (delivery orders)
  DELIVERED         // Teslim edildi
  SERVED            // Served to customer (dine-in)
  COMPLETED         // Paid and closed
  CANCELLED         // Cancelled
}

enum OrderType {
  DINE_IN      // Table order
  TAKEAWAY     // Paket
  DELIVERY     // Eve servis (kurye ile)
  ROOM_SERVICE // Oda servisi (otel)
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  DEBIT_CARD
  ONLINE
  MULTINET
  SODEXO
  TICKET
  TAB          // Hesaba ekle (sonra öde)
  DIGITAL_COIN // Festival için dijital coin
  OTHER
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  REFUNDED
  ON_TAB       // Hesap açık
}

model Order {
  id             String        @id @default(cuid())
  orderNumber    Int           @unique @default(autoincrement())
  locationId     String?
  tableId        String?
  userId         String?       // Waiter who created the order
  courierId      String?       // Kurye ID
  customerName   String?
  customerPhone  String?
  customerEmail  String?
  customerAddress String?      // Teslimat adresi
  roomNumber     String?       // Otel oda numarası
  type           OrderType     @default(DINE_IN)
  status         OrderStatus   @default(PENDING)
  paymentStatus  PaymentStatus @default(PENDING)
  paymentMethod  PaymentMethod?
  
  // Pricing
  subtotal       Decimal       @db.Decimal(10, 2)
  tax            Decimal       @default(0) @db.Decimal(10, 2)
  serviceCharge  Decimal       @default(0) @db.Decimal(10, 2) // Servis ücreti
  deliveryFee    Decimal       @default(0) @db.Decimal(10, 2) // Kurye ücreti
  discount       Decimal       @default(0) @db.Decimal(10, 2)
  total          Decimal       @db.Decimal(10, 2)
  tip            Decimal       @default(0) @db.Decimal(10, 2)
  
  // Tab (Sonradan ödeme) settings
  isTab          Boolean       @default(false) // Hesap açık mı
  tabClosedAt    DateTime?     // Hesap ne zaman kapandı
  
  // Kurye bilgileri
  assignedAt     DateTime?     // Kuryeye atanma zamanı
  pickedUpAt     DateTime?     // Yola çıkma zamanı
  deliveredAt    DateTime?     // Teslim zamanı
  
  notes          String?
  source         String?       // "POS", "WhatsApp", "Web", "QR"
  
  // Analytics
  deviceType     String?       // "mobile", "tablet", "desktop"
  userAgent      String?
  
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  completedAt    DateTime?

  location Location? @relation(fields: [locationId], references: [id])
  table    Table?    @relation(fields: [tableId], references: [id])
  user     User?     @relation("WaiterOrders", fields: [userId], references: [id])
  courier  User?     @relation("CourierOrders", fields: [courierId], references: [id])
  items    OrderItem[]
  invoice  Invoice?
  payments Payment[]
}

model OrderItem {
  id           String      @id @default(cuid())
  orderId      String
  menuItemId   String
  quantity     Int         @default(1)
  paidQuantity Int         @default(0) // Ödenen miktar
  unitPrice    Decimal     @db.Decimal(10, 2)
  total        Decimal     @db.Decimal(10, 2)
  notes        String?
  modifiers    String[]    // Applied modifier names
  status       OrderStatus @default(PENDING)
  isUpsell     Boolean     @default(false) // Upsell'den mi geldi
  isCrossSell  Boolean     @default(false) // Cross-sell'den mi geldi
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  order    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem MenuItem @relation(fields: [menuItemId], references: [id])
}

// ==================== PAYMENT & INVOICING ====================

model Payment {
  id         String        @id @default(cuid())
  orderId    String
  amount     Decimal       @db.Decimal(10, 2)
  tipAmount  Decimal       @default(0) @db.Decimal(10, 2) // Bahşiş miktarı
  method     PaymentMethod
  reference  String?       // Transaction ID, etc.
  paidItems  Json?         // { itemId: quantity } hangi ürünlerden kaç adet ödendi
  refunded   Boolean       @default(false)
  refundedAt DateTime?
  refundedBy String?       // User ID who refunded
  createdAt  DateTime      @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Invoice {
  id            String   @id @default(cuid())
  orderId       String   @unique
  invoiceNumber String   @unique
  customerName  String?
  customerTaxId String?
  subtotal      Decimal  @db.Decimal(10, 2)
  tax           Decimal  @db.Decimal(10, 2)
  serviceCharge Decimal  @default(0) @db.Decimal(10, 2)
  tip           Decimal  @default(0) @db.Decimal(10, 2)
  total         Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

// ==================== PRINTER MANAGEMENT ====================

enum PrinterType {
  RECEIPT   // Fiş yazıcı
  KITCHEN   // Mutfak yazıcı
  BAR       // Bar yazıcı
  LABEL     // Etiket yazıcı
}

model Printer {
  id           String      @id @default(cuid())
  name         String      // "Mutfak Yazıcı 1"
  type         PrinterType @default(RECEIPT)
  ipAddress    String?     // Network printer
  port         Int         @default(9100)
  usbVendorId  String?     // USB printer
  usbProductId String?
  paperWidth   Int         @default(80) // 80mm, 58mm
  active       Boolean     @default(true)
  isDefault    Boolean     @default(false)
  categories   String[]    // Hangi kategorileri basar
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model PrintJob {
  id        String   @id @default(cuid())
  printerId String
  orderId   String?
  content   String   // Print content (ESC/POS commands or text)
  status    String   @default("PENDING") // PENDING, PRINTING, COMPLETED, FAILED
  error     String?
  createdAt DateTime @default(now())
  printedAt DateTime?
}

// ==================== WHATSAPP INTEGRATION ====================

model WhatsAppMessage {
  id          String   @id @default(cuid())
  messageId   String   @unique // WhatsApp message ID
  from        String   // Phone number
  body        String
  timestamp   DateTime
  processed   Boolean  @default(false)
  orderId     String?  // If converted to order
  createdAt   DateTime @default(now())
}

// ==================== REPORTING ====================

model DailyReport {
  id             String   @id @default(cuid())
  locationId     String?
  date           DateTime @db.Date
  totalOrders    Int      @default(0)
  totalRevenue   Decimal  @default(0) @db.Decimal(10, 2)
  cashAmount     Decimal  @default(0) @db.Decimal(10, 2)
  cardAmount     Decimal  @default(0) @db.Decimal(10, 2)
  onlineAmount   Decimal  @default(0) @db.Decimal(10, 2)
  tipAmount      Decimal  @default(0) @db.Decimal(10, 2)
  serviceChargeAmount Decimal @default(0) @db.Decimal(10, 2)
  otherAmount    Decimal  @default(0) @db.Decimal(10, 2)
  cancelCount    Int      @default(0)
  avgOrderTime   Int?     // in minutes
  avgOrderValue  Decimal? @db.Decimal(10, 2)
  customerCount  Int      @default(0)
  topItems       Json?    // [{ itemId, name, count, revenue }]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([locationId, date])
}

// ==================== SETTINGS ====================

model Settings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
}

// ==================== ANALYTICS ====================

model AnalyticsEvent {
  id         String   @id @default(cuid())
  locationId String?
  eventType  String   // "page_view", "add_to_cart", "order_completed", "upsell_accepted"
  eventData  Json?
  sessionId  String?
  deviceType String?
  userAgent  String?
  ipAddress  String?
  createdAt  DateTime @default(now())
}

// ==================== LOYALTY PROGRAM ====================

// Sadakat Programı Müşterisi
model Customer {
  id              String   @id @default(cuid())
  phone           String   @unique // Ana identifier
  email           String?  @unique
  name            String?
  birthDate       DateTime?
  password        String?  // Optional - for web login
  
  // Loyalty Info
  loyaltyTierId   String?
  totalPoints     Int      @default(0)
  lifetimePoints  Int      @default(0) // Toplam kazanılan puan
  totalSpent      Decimal  @default(0) @db.Decimal(10, 2) // Toplam harcama
  orderCount      Int      @default(0) // Sipariş sayısı
  
  // Marketing
  smsConsent      Boolean  @default(false)
  emailConsent    Boolean  @default(false)
  pushConsent     Boolean  @default(false)
  
  // Status
  isActive        Boolean  @default(true)
  isVerified      Boolean  @default(false) // Telefon doğrulandı mı
  verificationCode String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  lastOrderAt     DateTime?

  loyaltyTier     LoyaltyTier? @relation(fields: [loyaltyTierId], references: [id])
  orders          CustomerOrder[]
  pointsHistory   PointsTransaction[]
  usedCoupons     CouponUsage[]
  
  @@index([phone])
  @@index([email])
}

// Sadakat Seviyesi (Bronze, Silver, Gold vb.)
model LoyaltyTier {
  id               String   @id @default(cuid())
  name             String   // "Bronze", "Silver", "Gold", "Platinum"
  minPoints        Int      // Bu seviyeye ulaşmak için gereken min puan
  pointsMultiplier Decimal  @default(1) @db.Decimal(3, 2) // Puan çarpanı (1.5x = %50 daha fazla puan)
  discountPercent  Decimal  @default(0) @db.Decimal(5, 2) // Sabit % indirim
  benefits         Json?    // Ek avantajlar listesi
  color            String?  // Badge rengi (#CD7F32 = bronze)
  icon             String?  // Emoji veya icon
  sortOrder        Int      @default(0)
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  customers Customer[]
}

// Puan İşlemleri
model PointsTransaction {
  id          String   @id @default(cuid())
  customerId  String
  orderId     String?
  points      Int      // + kazanım, - harcama
  type        String   // "EARN", "SPEND", "BONUS", "EXPIRE", "ADJUSTMENT"
  description String?  // "Sipariş #123", "10 siparişe özel 100 puan"
  createdAt   DateTime @default(now())

  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

// Müşteri Siparişleri (Order'a referans)
model CustomerOrder {
  id          String   @id @default(cuid())
  customerId  String
  orderId     String   @unique
  pointsEarned Int     @default(0)
  pointsSpent  Int     @default(0)
  createdAt   DateTime @default(now())

  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

// ==================== CAMPAIGNS & PROMOTIONS ====================

// İndirim Kampanyaları
model Campaign {
  id              String   @id @default(cuid())
  name            String
  description     String?
  type            String   // "DISCOUNT", "BOGO", "FREE_ITEM", "POINTS_MULTIPLIER", "MIN_PURCHASE"
  
  // Koşullar
  minPurchase     Decimal? @db.Decimal(10, 2) // Min sepet tutarı
  minItems        Int?     // Min ürün sayısı
  loyaltyTierIds  String[] // Hangi üyelik seviyeleri için geçerli
  applicableItems String[] // Geçerli ürün ID'leri (boş = hepsi)
  excludedItems   String[] // Hariç tutulan ürünler
  
  // İndirim
  discountType    String?  // "PERCENT", "FIXED", "FREE_ITEM"
  discountValue   Decimal? @db.Decimal(10, 2) // % veya sabit tutar
  freeItemId      String?  // Bedava verilecek ürün
  maxDiscount     Decimal? @db.Decimal(10, 2) // Max indirim limiti
  
  // Geçerlilik
  startDate       DateTime
  endDate         DateTime
  daysOfWeek      Int[]    // 0-6 (boş = her gün)
  startTime       String?  // "10:00"
  endTime         String?  // "22:00"
  
  // Limitleme
  usageLimit      Int?     // Toplam kullanım limiti
  usagePerCustomer Int?    // Kişi başı limit
  currentUsage    Int      @default(0)
  
  // Status
  isActive        Boolean  @default(true)
  autoApply       Boolean  @default(false) // Otomatik uygulan mı
  stackable       Boolean  @default(false) // Diğer kampanyalarla birleştirilebilir mi
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  happyHours      HappyHour[] // Bu kampanyayı kullanan happy hour'lar
}

// Paket Menüler / Combo'lar
model BundleDeal {
  id              String   @id @default(cuid())
  name            String   // "Aile Paketi", "Öğle Menüsü"
  description     String?
  image           String?
  
  // Fiyatlandırma
  originalPrice   Decimal  @db.Decimal(10, 2) // Normal toplam fiyat
  bundlePrice     Decimal  @db.Decimal(10, 2) // Paket fiyatı
  savings         Decimal  @db.Decimal(10, 2) // Tasarruf miktarı
  
  // Geçerlilik
  startDate       DateTime?
  endDate         DateTime?
  daysOfWeek      Int[]    // Hangi günler geçerli
  startTime       String?
  endTime         String?
  
  // Status
  isActive        Boolean  @default(true)
  featured        Boolean  @default(false) // Öne çıkan mı
  sortOrder       Int      @default(0)
  
  // Analytics
  soldCount       Int      @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  items           BundleItem[]
}

// Paket İçindeki Ürünler
model BundleItem {
  id          String   @id @default(cuid())
  bundleId    String
  menuItemId  String
  quantity    Int      @default(1)
  isOptional  Boolean  @default(false) // Seçimli mi
  optionGroup String?  // "Ana Yemek", "İçecek" - aynı grup içinden seç
  createdAt   DateTime @default(now())

  bundle   BundleDeal @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  menuItem MenuItem   @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
  
  @@unique([bundleId, menuItemId])
}

// Kuponlar
model Coupon {
  id              String   @id @default(cuid())
  code            String   @unique // "HOSGELDIN20", "DOGUMGUNU50"
  name            String
  description     String?
  
  // İndirim
  discountType    String   // "PERCENT", "FIXED"
  discountValue   Decimal  @db.Decimal(10, 2)
  maxDiscount     Decimal? @db.Decimal(10, 2)
  minPurchase     Decimal? @db.Decimal(10, 2)
  
  // Geçerlilik
  startDate       DateTime
  endDate         DateTime
  
  // Limitleme
  usageLimit      Int?     // Toplam kullanım
  usagePerCustomer Int     @default(1) // Kişi başı
  currentUsage    Int      @default(0)
  
  // Hedef kitle
  loyaltyTierIds  String[] // Hangi üyelik seviyeleri
  isFirstOrder    Boolean  @default(false) // Sadece ilk sipariş için
  
  // Status
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  usages          CouponUsage[]
}

// Kupon Kullanımları
model CouponUsage {
  id          String   @id @default(cuid())
  couponId    String
  customerId  String?
  orderId     String
  discount    Decimal  @db.Decimal(10, 2) // Uygulanan indirim
  createdAt   DateTime @default(now())

  coupon   Coupon    @relation(fields: [couponId], references: [id], onDelete: Cascade)
  customer Customer? @relation(fields: [customerId], references: [id])
}
